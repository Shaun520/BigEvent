import{x as F,y as T,E as R,d as H,c as M,l as q,A as J,e as j,g as $,B as K,k as W,f as X,C as Z,D as h,F as ee,G as te}from"./element-plus-Dvbun8KL.js";import{g as ae,u as le,a as oe,b as ne,c as se,_ as ie,d as re}from"./article-C4bL6IwE.js";import{F as ue,G as ce,r as pe}from"./@element-plus-Bha-lu0l.js";import{r as m,o as v,R as k,Q as a,c as I,O as de,ag as me,T as _e,M as e,u as z,a as fe,U as g,_ as ve,V as B}from"./@vue-b6zKPkmM.js";import{Q as ge}from"./@vueup-xcdAIoqZ.js";import{c as ye}from"./index-BwZAcyZZ.js";import{a as be}from"./axios-BDQOBJsj.js";import{_ as we}from"./plugin-vueexport-helper-DlAUqK2U.js";import{d as Ve}from"./dayjs-Btipwhah.js";import"./lodash-es-CxpLErxa.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-kHQqd-GD.js";import"./@ctrl-r5W6hzzQ.js";import"./@sxzz-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./quill-b29DI-Hn.js";import"./quill-delta-BI94RzGj.js";import"./fast-diff-DNDSwfiB.js";import"./lodash.clonedeep-CSjm15Ai.js";import"./lodash.isequal-C90DUZwY.js";import"./pinia-5OhCMEEp.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-BQU3TZ4K.js";import"./destr-CVtkxrq9.js";import"./deep-pick-omit-CegYQlcN.js";import"./vue-router-BF8_ddcx.js";const N={__name:"ChannelSelect",props:{modelValue:[Number,String],width:String},emits:["update:modelValue"],setup(y,{emit:b}){const _=m([]);(async()=>{const t=await ae();_.value=t.data.data})();const s=b;return(t,u)=>{const E=F,w=T;return v(),k(w,{style:_e({width:y.width}),modelValue:y.modelValue,"onUpdate:modelValue":u[0]||(u[0]=d=>s("update:modelValue",d))},{default:a(()=>[(v(!0),I(de,null,me(_.value,d=>(v(),k(E,{key:d.id,label:d.cate_name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["style","modelValue"])}}},ke=["src"],Ee={class:"editor"},xe={__name:"ArticleEdit",emits:["success"],setup(y,{expose:b,emit:_}){const p=m(!1),s={title:"",cate_id:"",cover_img:"",content:"",state:""},t=m({...s}),u=m(""),E=r=>{u.value=URL.createObjectURL(r.raw),t.value.cover_img=r.raw},w=_,d=async r=>{t.value.state=r;const l=new FormData;for(let o in t.value)l.append(o,t.value[o]);t.value.id?(await le(l),R.success("修改成功"),p.value=!1,w("success","edit")):(await oe(l),R.success("添加成功"),p.value=!1,w("success","add"))},V=m(),S=async r=>{if(p.value=!0,r.id){const l=await ne(r.id);t.value=l.data.data,u.value=ye+t.value.cover_img;const o=await A(u.value,t.value.cover_img);t.value.cover_img=o}else t.value={...s},u.value="",V.value.setHTML("")};async function A(r,l){try{const o=await be.get(r,{responseType:"arraybuffer"}),n=new Blob([o.data],{type:o.headers["content-type"]});return new File([n],l,{type:o.headers["content-type"]})}catch(o){return console.error("Error converting image URL to File object:",o),null}}return b({open:S}),(r,l)=>{const o=H,n=M,f=q,x=J,C=j,D=$,L=K;return v(),k(L,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=c=>p.value=c),title:t.value.id?"编辑文章":"添加文章",direction:"rtl",size:"50%"},{default:a(()=>[e(D,{model:t.value,ref:"formRef","label-width":"100px"},{default:a(()=>[e(n,{label:"文章标题",prop:"title"},{default:a(()=>[e(o,{modelValue:t.value.title,"onUpdate:modelValue":l[0]||(l[0]=c=>t.value.title=c),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),e(n,{label:"文章分类",prop:"cate_id"},{default:a(()=>[e(N,{modelValue:t.value.cate_id,"onUpdate:modelValue":l[1]||(l[1]=c=>t.value.cate_id=c),width:"100%"},null,8,["modelValue"])]),_:1}),e(n,{label:"文章封面",prop:"cover_img"},{default:a(()=>[e(x,{class:"avatar-uploader","show-file-list":!1,"auto-upload":!1,"on-change":E},{default:a(()=>[u.value?(v(),I("img",{key:0,src:u.value,class:"avatar"},null,8,ke)):(v(),k(f,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[e(z(ue))]),_:1}))]),_:1})]),_:1}),e(n,{label:"文章内容",prop:"content"},{default:a(()=>[fe("div",Ee,[e(z(ge),{ref_key:"editorRef",ref:V,content:t.value.content,"onUpdate:content":l[2]||(l[2]=c=>t.value.content=c),"content-type":"html",theme:"snow"},null,8,["content"])])]),_:1}),e(n,null,{default:a(()=>[e(C,{onClick:l[3]||(l[3]=c=>d("已发布")),type:"primary"},{default:a(()=>l[6]||(l[6]=[g("发布")])),_:1}),e(C,{onClick:l[4]||(l[4]=c=>d("草稿")),type:"info"},{default:a(()=>l[7]||(l[7]=[g("草稿")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Ce=we(xe,[["__scopeId","data-v-1be52d12"]]),Ue=y=>Ve(y).format("YYYY-MM-DD"),he={__name:"ArticleManage",setup(y){const b=m([]),_=m(0),p=m(!1),s=m({pagenum:1,pagesize:5,cate_id:"",state:""}),t=async()=>{p.value=!0;const o=await se(s.value);b.value=o.data.data,_.value=o.data.total,p.value=!1};t();const u=o=>{s.value.pagenum=1,s.value.pagesize=o,t()},E=o=>{s.value.pagenum=o,t()},w=()=>{s.value.pagenum=1,t()},d=()=>{s.value.pagenum=1,s.value.cate_id="",s.value.state="",t()},V=m(),S=()=>{V.value.open({})},A=o=>{V.value.open(o)},r=async o=>{await W.confirm("确定删除该文章吗？","温馨提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),await re(o.id),R.success("删除成功"),t()},l=o=>{if(o=="add"){const n=Math.ceil((_.value+1)/s.value.pagesize);s.value.pagenum=n}t()};return(o,n)=>{const f=j,x=M,C=F,D=T,L=$,c=X,U=Z,O=h,Y=ee,G=ie,P=te;return v(),k(G,{title:"文章管理"},{extra:a(()=>[e(f,{type:"primary",onClick:S},{default:a(()=>n[4]||(n[4]=[g("发布文章")])),_:1})]),default:a(()=>[e(L,{inline:""},{default:a(()=>[e(x,{label:"文章分类"},{default:a(()=>[e(N,{modelValue:s.value.cate_id,"onUpdate:modelValue":n[0]||(n[0]=i=>s.value.cate_id=i),width:"240px"},null,8,["modelValue"])]),_:1}),e(x,{label:"发布状态"},{default:a(()=>[e(D,{style:{width:"240px"},modelValue:s.value.state,"onUpdate:modelValue":n[1]||(n[1]=i=>s.value.state=i)},{default:a(()=>[e(C,{label:"已发布",value:"已发布"}),e(C,{label:"草稿",value:"草稿"})]),_:1},8,["modelValue"])]),_:1}),e(x,null,{default:a(()=>[e(f,{onClick:w,type:"primary"},{default:a(()=>n[5]||(n[5]=[g("搜索")])),_:1}),e(f,{onClick:d},{default:a(()=>n[6]||(n[6]=[g("重置")])),_:1})]),_:1})]),_:1}),ve((v(),k(O,{data:b.value},{default:a(()=>[e(U,{label:"文章标题",prop:"title"},{default:a(({row:i})=>[e(c,{type:"primary",underline:!1},{default:a(()=>[g(B(i.title),1)]),_:2},1024)]),_:1}),e(U,{label:"分类",prop:"cate_name"}),e(U,{label:"发表时间",prop:"pub_date"},{default:a(({row:i})=>[g(B(z(Ue)(i.pub_date)),1)]),_:1}),e(U,{label:"状态",prop:"state"}),e(U,{label:"操作"},{default:a(({row:i})=>[e(f,{type:"primary",circle:"",plain:"",onClick:Q=>A(i),icon:z(ce)},null,8,["onClick","icon"]),e(f,{type:"danger",circle:"",plain:"",onClick:Q=>r(i),icon:z(pe)},null,8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[P,p.value]]),e(Y,{"current-page":s.value.pagenum,"onUpdate:currentPage":n[2]||(n[2]=i=>s.value.pagenum=i),"page-size":s.value.pagesize,"onUpdate:pageSize":n[3]||(n[3]=i=>s.value.pagesize=i),"page-sizes":[2,3,5,10],background:!0,layout:"jumper,total, sizes, prev, pager, next",total:_.value,onSizeChange:u,onCurrentChange:E,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"]),e(Ce,{ref_key:"DrawerRef",ref:V,onSuccess:l},null,512)]),_:1})}}};export{he as default};
